---
import GitHub from "./icons/GitHub.astro";
import Tailwind from "./icons/Tailwind.astro";
import Link from "./icons/Link.astro";
import LinkButton from "./LinkButton.astro";
import Python from "./icons/Python.astro";
import JavaScript from "./icons/JavaScript.astro";
import PHP from "./icons/PHP.astro";
import MySQL from "./icons/MySQL.astro";
import Git from "./icons/Git.astro";
import LINUX from "./icons/Linux.astro";
import AWS from "./icons/aws.astro";

type Tag = {
  name: string;
  class: string;
  icon?: any;
};

const TAGS: Record<string, Tag> = {
  TAILWIND: {
    name: "Tailwind CSS",
    class: "bg-[#003159] text-white",
    icon: Tailwind,
  },
  GIT: {
    name: "Git",
    class: "bg-gray-900 text-[#F1502F]",
    icon: Git,
  },
  PHP: {
    name: "PHP",
    class: "bg-[#777BB3] text-white",
    icon: PHP,
  },
  MYSQL: {
    name: "MySQL",
    class: "bg-white text-[#4479A1]",
    icon: MySQL,
  },
  JAVASCRIPT: {
    name: "JavaScript",
    class: "bg-[#F7DF1E] text-black",
    icon: JavaScript,
  },
  PYTHON: {
    name: "Python",
    class: "bg-[#e0f1fc] text-[#3776AB]",
    icon: Python,
  },
  LINUX: {
    name: "Linux",
    class: "bg-white text-black",
    icon: LINUX,
  },
  AWS: {
    name: "AWS",
    class: "bg-[#f8f8f8] text-[#FF9900]",
    icon: AWS,
  },
};

const PROJECTS = [
  {
    title: "Universidad Anáhuac",
    description: `Durante 5 años desarrollé y mantuve sistemas web que ayudaron a digitalizar procesos académicos y administrativos. Usé PHP, JavaScript y MySQL para crear herramientas más rápidas, seguras y fáciles de usar. También implementé flujos de trabajo con Git, asegurando que el desarrollo fuera ordenado y colaborativo. El resultado: estudiantes y personal con procesos más simples y eficientes.`,
    link: null,
    github: null,
    image: {
      light: "/anahuac-light.png",
      dark: "/anahuac-dark.png",
    },
    tags: [TAGS.PHP, TAGS.JAVASCRIPT, TAGS.MYSQL, TAGS.GIT],
  },
  {
    title: "Hamster Connect",
    description: `Trabajé con equipos internacionales para construir la base de una red social y financiera para inversionistas, brokers y aceleradoras. Diseñé el backend en PHP y MySQL priorizando escalabilidad y seguridad. En frontend, desarrollé interfaces rápidas y modernas con HTML, CSS y JavaScript, siempre pensando en la experiencia del usuario y el objetivo de negocio.`,
    link: null,
    github: null,
    image: {
      light: "/hamster-light.png",
      dark: "/hamster-dark.png",
    },
    tags: [TAGS.PHP, TAGS.MYSQL, TAGS.GIT],
  },
  {
    title: "Desarrollo Web Freelance",
    description: `Ayudo a pequeñas empresas y emprendedores a tener presencia digital desde cero. Me encargo de todo: diseño, desarrollo y despliegue. He creado soluciones a medida con HTML, CSS, JavaScript, PHP y Python, cuidando rendimiento, seguridad y facilidad de mantenimiento. También desarrollo scripts y automatizaciones que ahorran tiempo y evitan tareas repetitivas.`,
    link: null,
    github: null,
    image: null,
    tags: [TAGS.JAVASCRIPT, TAGS.PHP, TAGS.GIT, TAGS.PYTHON],
  },
];
---

<div class="flex flex-col gap-y-16">
  {PROJECTS.map(({ image, title, description, tags, link, github }) => (
    <article
      class="flex flex-col md:flex-row md:space-x-8 space-y-8 md:space-y-0 group shadow-lg text-justify rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"
    >
      {image && (
        <div class="w-full md:w-5/12 flex items-center justify-center p-2 bg-transparent dark:bg-transparent">
          <div class="relative w-full h-56 md:h-full flex items-center justify-center">
            <img
              id={`project-image-${title.replace(/\s+/g, "-").toLowerCase()}`}
              data-light={image.light}
              data-dark={image.dark}
              src={image.light}
              alt={title}
              class="transition-transform duration-500 group-hover:scale-105 object-contain max-h-[160px] max-w-[220px] w-auto"
              loading="lazy"
              style="image-rendering:auto;"
            />
          </div>
        </div>
      )}

      <div class={`w-full ${image ? "md:w-7/12" : "md:w-full"} p-6 flex flex-col justify-between`}>
        <div>
          <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">{title}</h3>
          <ul class="flex flex-wrap gap-2 mt-2 mb-4">
            {tags.map((tag) => (
              <li>
                <span
                  class={`inline-flex items-center gap-1 rounded-full py-1 px-3 text-xs font-semibold ${tag.class}`}
                >
                  {tag.icon && <tag.icon class="w-4 h-4" />}
                  {tag.name}
                </span>
              </li>
            ))}
          </ul>
          <p class="text-gray-700 dark:text-gray-300 whitespace-pre-line">{description}</p>
        </div>
        <footer class="mt-6 flex gap-4">
          {github && (
            <LinkButton href={github}>
              <GitHub class="w-5 h-5" />
              Código
            </LinkButton>
          )}
          {link && (
            <LinkButton href={link}>
              <Link class="w-5 h-5" />
              Vista
            </LinkButton>
          )}
        </footer>
      </div>
    </article>
  ))}
</div>

<!-- Script para actualizar imágenes según tema -->
<script>
  document.addEventListener("astro:page-load", () => {
    const isDark = () => document.documentElement.classList.contains("dark");

    const updateImages = () => {
      document.querySelectorAll("img[data-light][data-dark]").forEach((el) => {
        if (el instanceof HTMLImageElement) {
          const light = el.getAttribute("data-light");
          const dark = el.getAttribute("data-dark");
          el.src = isDark() ? dark! : light!;
        }
      });
    };

    updateImages();

    const observer = new MutationObserver(updateImages);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["class"],
    });
  });
</script>
